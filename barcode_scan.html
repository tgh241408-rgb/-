<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>급식 바코드 스캔</title>
<style>
body { margin:0; padding:0; font-family:sans-serif; background:#000; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
#reader { width:100%; max-width:600px; }
#message { position:absolute; top:20px; font-size:2em; padding:10px 20px; background:rgba(0,0,0,0.6); border-radius:10px; }
</style>
</head>
<body>

<div id="reader"></div>
<div id="message"></div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const sheetUrl = 'https://script.google.com/macros/s/AKfycbzD1qDfmEUyhYTR9tv_rah7xN4Ramcbpd5X_a3jaLQP4tptpgWv2i_JgNo6Ig-v5YK1vA/exec'; // 배포한 GAS URL 입력
const message = document.getElementById('message');

function showMessage(msg,d=1500){ message.textContent=msg; setTimeout(()=>{message.textContent='';},d); }

function sendToSheet(studentId){
  fetch(sheetUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({studentId}) })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==='duplicate') showMessage('이미 처리되었습니다');
    else if(data.status==='ok') showMessage('등록 완료');
    else showMessage('오류 발생');
  })
  .catch(err=>{ console.error(err); showMessage('통신 오류'); });
}

const html5QrCode = new Html5Qrcode("reader");

html5QrCode.start(
  { facingMode: "environment" }, 
  { fps:10, qrbox:250 },
  (decodedText)=>{
      showMessage("스캔 완료");
      sendToSheet(decodedText);
  },
  (errorMessage)=>{}
).catch(err=>{ showMessage("카메라 오류"); });
</script>

</body>
</html>